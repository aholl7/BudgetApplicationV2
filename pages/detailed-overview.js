import Head from "next/head"
import Image from "next/image"
import Logo from "../public/images/logo.png";
import { useState, useEffect } from "react";
import { db, auth } from "../js/firebase.js";
import {onAuthStateChanged} from "firebase/auth";
import {
    getDoc,
    doc,
  } from  "firebase/firestore";
import { 
    Grid, 
    GridItem, 
    Button,
    Box,
} from "@chakra-ui/react";
import NavBar from "../components/NavBar";
import LoadingScreen from "../components/LoadingScreen";
import DetailsTable from "../components/DetailsTable";

const DetailedOverview = () => {
    const [userInfo, setUserInfo] = useState({uid: "", firstName: "", lastName: "", email: ""})
    const [loading, setLoading] = useState(true);
    
  const signOut = (e) => {
    e.preventDefault();
    auth.signOut();
    const url = "/login";
    window.location.href = url;
  }

  const getUserInfo = async (uid) => {
    const docRef = doc(db, "users", uid);
    const docSnap = await getDoc(docRef);
    if (docSnap.exists()) {
        //console.log(docSnap.data())
        setUserInfo({uid: uid, firstName: docSnap.data().firstName, lastName: docSnap.data().lastName, email: docSnap.data().email})
        setLoading(false);
      } else {
        // doc.data() will be undefined in this case
        window.alert("No such document!");
      }
  }
  useEffect(()=>{
    onAuthStateChanged(auth, (user) => {
        if (user) {
          const uid = user.uid;
          getUserInfo(uid);
        } else {
          // User is signed out
          // ...
        }
      });
  },[]);
  if(loading == true){
      return (
          <LoadingScreen />
      )
  }else{
    document.body.style.backgroundColor = "#221266";
    return (
        <Box>
        <Head>
            <title>Overview</title>
            <meta name="description" content="Generated by create next app" />
            <link rel="icon" href="/favicon.ico" />
        </Head>
        
        <main>
            <NavBar auth={auth}/>
            <Box>
            
            </Box>
            
            <Box 
                
                width="90%"
                marginLeft="auto" 
                marginRight="auto"
                
            >
                <h1 
                    style={{
                    color: "#0ACF83", 
                    fontSize: "38px", 
                    fontWeight: "bold",
                    marginTop: "55px"
                    }}
                >
                    DETAILED BREAKDOWN OF YOUR BUDGET
                </h1>
                
                <DetailsTable uid={userInfo.uid} type={"Expenses"}/>
                <Box marginTop="40px"></Box>
                <DetailsTable uid={userInfo.uid} type={"Income"}/>
                
                <Box marginTop="40px"></Box>
                <DetailsTable uid={userInfo.uid} type={"Totals"}/>
            </Box>
            <Box marginTop="40px"></Box>
            
        </main>
        
        
        
        </Box>
    )
    }
}

export default DetailedOverview;